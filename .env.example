# =============================================================================
# CONFIGURA√á√ïES DO SISTEMA DE BACKUP MARIADB/MYSQL - EXEMPLO
# =============================================================================
# Copie este arquivo para .env e configure suas vari√°veis
#
# üìã ESCOLHA O TEMPLATE ADEQUADO:
# 
# üîπ Para bancos PEQUENOS/M√âDIOS (at√© 50GB):
#    Use este arquivo: .env.example
#
# üîπ Para bancos GRANDES (200GB+ com tabelas de 30-80GB):
#    Use: .env.example.large (otimizado para chunking e zero locks)
#
# =============================================================================

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES DOS SERVIDORES DE BANCO DE DADOS
# -----------------------------------------------------------------------------

# Servidor de origem (onde est√£o os dados para backup)
SOURCE_HOST=localhost
SOURCE_PORT=3306

# Servidor de destino (onde os backups ser√£o restaurados)
DEST_HOST=localhost
DEST_PORT=3306

# Credenciais de acesso aos bancos de dados
DB_USERNAME=backup_user
DB_PASSWORD=ALTERE_ESTA_SENHA

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES DE BACKUP
# -----------------------------------------------------------------------------

# Databases a serem inclu√≠dos no backup (separados por v√≠rgula)
DATABASES=database1,database2,database3

# Agendamento do backup (formato cron)
# 0 2 * * * = Todo dia √†s 02:00
BACKUP_TIME="0 2 * * *"

# N√∫mero de dias para manter os backups (limpeza autom√°tica)
# Para DBs grandes, considere 14+ dias devido ao tempo de gera√ß√£o
RETENTION_DAYS=7

# Ativar compress√£o dos backups (true/false)
BACKUP_COMPRESSION=true

# Prefixo dos arquivos de backup
BACKUP_PREFIX=backup

# Op√ß√µes adicionais do mysqldump
# Padr√£o: --routines --triggers --single-transaction --add-drop-database --default-character-set=utf8mb4
# Para DBs grandes, adicione: --quick --lock-tables=false --column-statistics=0 --disable-keys --extended-insert=false
MYSQLDUMP_OPTIONS="--routines --triggers --single-transaction --add-drop-database --default-character-set=utf8mb4 --ssl=0"

# Executar backup na inicializa√ß√£o do container (true/false)
RUN_ON_START=false

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES DE SISTEMA
# -----------------------------------------------------------------------------

# Timezone do sistema
TZ=America/Sao_Paulo

# N√≠vel de log (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES DE NOTIFICA√á√ïES POR EMAIL (OPCIONAL)
# -----------------------------------------------------------------------------

# Ativar notifica√ß√µes por email (true/false)
ENABLE_EMAIL_NOTIFICATIONS=false

# Configura√ß√µes do email
EMAIL_FROM=backup@exemplo.com
EMAIL_TO=admin@exemplo.com
EMAIL_SUBJECT_PREFIX=[BACKUP-MYSQL]

# Configura√ß√µes do servidor SMTP
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=backup@exemplo.com
SMTP_PASSWORD=senha_smtp

# Usar TLS/SSL (true/false)
SMTP_USE_TLS=true

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES DE WEBHOOK (OPCIONAL)
# -----------------------------------------------------------------------------

# URL do webhook para notifica√ß√µes (Slack, Discord, Teams, etc.)
# Deixe vazio para desabilitar
WEBHOOK_URL=

# Nome do webhook (aparece nas notifica√ß√µes)
WEBHOOK_USERNAME="Backup System"

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES AVAN√áADAS (OPCIONAL)
# -----------------------------------------------------------------------------

# Timeout para conex√µes de banco de dados (segundos)
# Para DBs grandes, use 300 (5 minutos) ou mais
DB_TIMEOUT=30

# Timeout espec√≠fico para opera√ß√µes de leitura da rede MySQL (segundos)
# Para DBs grandes (>50GB), recomendado: 7200 (2 horas)
NET_READ_TIMEOUT=600

# Timeout espec√≠fico para opera√ß√µes de escrita da rede MySQL (segundos)
# Para DBs grandes (>50GB), recomendado: 7200 (2 horas)
NET_WRITE_TIMEOUT=600

# Tamanho m√°ximo de pacote MySQL
# Para DBs grandes, use 1G ou 512M
MAX_ALLOWED_PACKET=128M

# Timeout geral para o processo mysqldump (segundos)
# Para DBs pequenos: 3600 (1h) | Para DBs grandes: 21600-28800 (6-8h)
MYSQLDUMP_TIMEOUT=3600

# N√∫mero m√°ximo de tentativas de conex√£o
# Para DBs grandes, recomendado: 3-5 tentativas
MAX_RETRY_ATTEMPTS=3

# Intervalo entre tentativas (segundos)
# Para DBs grandes, use 10-60 segundos
RETRY_INTERVAL=5

# Ativar logs detalhados (true/false)
# Recomendado: true para DBs grandes para monitoramento
ENABLE_DEBUG_LOGS=false

# Verificar integridade dos backups ap√≥s cria√ß√£o (true/false)
VERIFY_BACKUP_INTEGRITY=true

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES DE BACKUP POR CHUNKS (TABELAS GRANDES)
# -----------------------------------------------------------------------------
# ‚ö° NOVO: Sistema autom√°tico de backup por chunks para tabelas grandes

# Limite de tamanho para detectar tabelas grandes (MB)
# Tabelas maiores que este valor ser√£o processadas por chunks
# Recomendado: 1000MB (1GB) para evitar timeouts
CHUNK_SIZE_THRESHOLD_MB=1000

# Tamanho do chunk (n√∫mero de registros por chunk)
# Valores sugeridos:
# - 50000 para tabelas com registros pequenos (logs, eventos)
# - 25000 para tabelas com registros m√©dios (transa√ß√µes)
# - 10000 para tabelas com registros grandes (dados bin√°rios)
CHUNK_SIZE=50000

# Ativar backup por chunks automaticamente (true/false)
# true: Detecta automaticamente tabelas grandes e usa chunks
# false: Usa apenas backup tradicional
ENABLE_AUTO_CHUNKING=true

# Timeout espec√≠fico para cada chunk (segundos)
# Recomendado: 1800 (30 min) por chunk
CHUNK_TIMEOUT=1800

# N√∫mero m√°ximo de tentativas por chunk
CHUNK_MAX_RETRIES=3

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES ESPEC√çFICAS PARA DATABASES GRANDES (>50GB)
# -----------------------------------------------------------------------------
# ‚ö†Ô∏è  IMPORTANTE: Para databases >50GB, aplique as configura√ß√µes abaixo

# Ativar modo otimizado para databases grandes
# Valores: auto (detec√ß√£o autom√°tica) | true | false
LARGE_DB_MODE=auto

# Usar extended insert para melhor performance
# Para DBs grandes, recomendado: false (melhor recupera√ß√£o de erros)
USE_EXTENDED_INSERT=true

# Desabilitar estat√≠sticas de colunas (MySQL 8.0+)
# Para DBs grandes, recomendado: true
DISABLE_COLUMN_STATISTICS=false

# Usar quick mode para economizar mem√≥ria
# Para DBs grandes, recomendado: true
USE_QUICK_MODE=false

# -----------------------------------------------------------------------------
# EXEMPLO DE CONFIGURA√á√ÉO PARA DATABASE DE 200GB+ COM CHUNKS
# -----------------------------------------------------------------------------
# Descomente e ajuste para databases muito grandes com tabelas problem√°ticas:

# # Configura√ß√µes de conex√£o e timeout
# DB_TIMEOUT=300
# NET_READ_TIMEOUT=7200
# NET_WRITE_TIMEOUT=7200
# MAX_ALLOWED_PACKET=1G
# MYSQLDUMP_TIMEOUT=28800
# MAX_RETRY_ATTEMPTS=5
# RETRY_INTERVAL=60
# ENABLE_DEBUG_LOGS=true

# # Configura√ß√µes de backup tradicional
# LARGE_DB_MODE=true
# USE_EXTENDED_INSERT=false
# DISABLE_COLUMN_STATISTICS=true
# USE_QUICK_MODE=true
# RETENTION_DAYS=14
# BACKUP_TIME=0 22 * * *

# # Configura√ß√µes de chunks para tabelas grandes
# ENABLE_AUTO_CHUNKING=true
# CHUNK_SIZE_THRESHOLD_MB=1000
# CHUNK_SIZE=50000
# CHUNK_TIMEOUT=1800
# CHUNK_MAX_RETRIES=3

# -----------------------------------------------------------------------------
# GUIA DE CONFIGURA√á√ÉO POR TAMANHO DE DATABASE (COM CHUNKS)
# -----------------------------------------------------------------------------
# 
# üì¶ DATABASES PEQUENOS (<1GB):
# - Use configura√ß√µes padr√£o
# - MYSQLDUMP_TIMEOUT=1800 (30 min)
# - DB_TIMEOUT=30
# - ENABLE_AUTO_CHUNKING=false (n√£o necess√°rio)
# 
# üì¶ DATABASES M√âDIOS (1GB-50GB):
# - DB_TIMEOUT=300 (5 min)
# - MYSQLDUMP_TIMEOUT=7200 (2 horas)
# - NET_READ_TIMEOUT=3600, NET_WRITE_TIMEOUT=3600
# - ENABLE_AUTO_CHUNKING=true
# - CHUNK_SIZE_THRESHOLD_MB=1000
# 
# üì¶ DATABASES GRANDES (50GB-200GB):
# - DB_TIMEOUT=300, NET_READ_TIMEOUT=7200, NET_WRITE_TIMEOUT=7200
# - MYSQLDUMP_TIMEOUT=21600 (6 horas)
# - MAX_RETRY_ATTEMPTS=5, RETRY_INTERVAL=60
# - USE_QUICK_MODE=true, USE_EXTENDED_INSERT=false
# - ENABLE_AUTO_CHUNKING=true
# - CHUNK_SIZE_THRESHOLD_MB=500, CHUNK_SIZE=25000-50000
# 
# üì¶ DATABASES MUITO GRANDES (>200GB):
# - DB_TIMEOUT=300, NET_READ_TIMEOUT=7200, NET_WRITE_TIMEOUT=7200
# - MYSQLDUMP_TIMEOUT=28800 (8 horas)
# - MAX_RETRY_ATTEMPTS=5, RETRY_INTERVAL=60
# - ENABLE_DEBUG_LOGS=true, RETENTION_DAYS=14
# - Executar em hor√°rio de baixo uso: BACKUP_TIME=0 22 * * *
# - ENABLE_AUTO_CHUNKING=true
# - CHUNK_SIZE_THRESHOLD_MB=500, CHUNK_SIZE=50000
# - CHUNK_TIMEOUT=1800, CHUNK_MAX_RETRIES=3
# 
# üö® TROUBLESHOOTING COM CHUNKS:
# - Erro "Lost connection": O sistema de chunks resolve automaticamente
# - Timeout em tabela espec√≠fica: Reduza CHUNK_SIZE (ex: 25000 ‚Üí 10000)
# - Backup muito lento: Aumente CHUNK_SIZE (ex: 50000 ‚Üí 100000)
# - Problemas de mem√≥ria: Mantenha chunks pequenos (10000-25000)
# - Tabela sem PRIMARY KEY: Chunks usar√£o ordena√ß√£o natural (mais lento)
# 
# üí° VANTAGENS DO SISTEMA DE CHUNKS:
# - ‚úÖ Evita timeouts autom√°ticamente
# - ‚úÖ Permite monitoramento de progresso
# - ‚úÖ Retry individual por chunk (mais resiliente)
# - ‚úÖ N√£o requer altera√ß√µes no MariaDB
# - ‚úÖ Gera arquivo √∫nico consolidado
# - ‚úÖ Funciona com qualquer tamanho de tabela
#
# =============================================================================
# CONFIGURA√á√ïES DE CHUNKING AUTOM√ÅTICO PARA TABELAS GRANDES
# =============================================================================
# O sistema detecta automaticamente tabelas grandes e as processa em peda√ßos
# Para ativar, descomente e configure as vari√°veis abaixo:

# ENABLE_AUTO_CHUNKING=true
# CHUNK_SIZE_THRESHOLD_MB=1000    # Tabelas >1GB usar√£o chunks
# CHUNK_SIZE=50000                # Registros por chunk
# CHUNK_TIMEOUT=1800             # 30min por chunk
# CHUNK_MAX_RETRIES=3            # Tentativas por chunk
# CHUNK_INTERVAL_MS=100          # Pausa entre chunks

# üí° PARA BANCOS GRANDES (200GB+), use o template otimizado:
#    cp .env.example.large .env
