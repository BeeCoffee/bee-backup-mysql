# ===============================================
# CONFIGURAÇÃO OTIMIZADA PARA BANCOS DE 200GB+
# ===============================================

# ========== CONFIGURAÇÃO BÁSICA ==========
DB_USERNAME=backup-bee
DB_PASSWORD=seupassword

# Origem (asasaude)
SOURCE_HOST=10.0.0.88
SOURCE_PORT=3306
SOURCE_DATABASE=asasaude

# Destino (local para teste)
DEST_HOST=127.0.0.1
DEST_PORT=3306

# ========== CONFIGURAÇÕES DE PERFORMANCE ==========

# Timeout muito mais longo para backups grandes
MYSQLDUMP_TIMEOUT=43200  # 12 horas

# Timeout por chunk reduzido (5 minutos máximo)
CHUNK_TIMEOUT=300

# Chunk menor para tabelas muito grandes
CHUNK_SIZE=10000  # 10k registros por chunk (mais seguro)

# Intervalo entre chunks aumentado
CHUNK_INTERVAL_MS=2000  # 2 segundos entre chunks

# Limite para considerar tabela grande reduzido
LARGE_TABLE_THRESHOLD_MB=500  # 500MB já considera grande

# ========== CONFIGURAÇÕES DE MYSQLDUMP ULTRA OTIMIZADAS ==========
MYSQLDUMP_OPTIONS=--single-transaction --quick --lock-tables=false --no-tablespaces --skip-lock-tables --skip-add-locks --routines --triggers --default-character-set=utf8mb4 --max_allowed_packet=1G --net_buffer_length=64K --extended-insert=false --disable-keys --no-autocommit --set-charset --hex-blob

# ========== CONFIGURAÇÕES DE BACKUP ==========

# Compressão habilitada (essencial para 200GB)
BACKUP_COMPRESSION=true

# Verificação de integridade desabilitada temporariamente para ganhar tempo
VERIFY_BACKUP_INTEGRITY=false  

# Retenção reduzida para economizar espaço
BACKUP_RETENTION_DAYS=7

# ========== CONFIGURAÇÕES DE LOG ==========
BACKUP_LOG_LEVEL=INFO
ENABLE_DEBUG_LOG=false

# ========== CONFIGURAÇÕES DE CHUNKING AVANÇADO ==========

# Habilitar auto-chunking
ENABLE_AUTO_CHUNKING=true

# Força chunking mesmo em tabelas menores se o banco for grande
FORCE_CHUNKING_ON_LARGE_DB=true

# ========== CONFIGURAÇÕES DE REDE ==========

# Configurações de rede mais robustas para conexões longas
MYSQL_CLIENT_OPTIONS=--connect-timeout=60 --max_allowed_packet=1G --net_read_timeout=600 --net_write_timeout=600

# ========== CONFIGURAÇÕES ESPECÍFICAS PARA PRODUÇÃO ==========

# Evitar locks em produção
USE_PRODUCTION_SAFE_SETTINGS=true

# Prioridade baixa para não impactar produção  
MYSQL_PRIORITY=LOW_PRIORITY

# ========== CONFIGURAÇÃO DE AGENDAMENTO ==========
# Para banco de 200GB, rodar apenas 1x por semana
BACKUP_SCHEDULE="0 2 * * 0"  # Domingo às 2h da manhã
