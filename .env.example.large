# =============================================================================
# CONFIGURA√á√ÉO ULTRA ZERO-LOCK PARA BANCOS GRANDES EM PRODU√á√ÉO
# =============================================================================
# Este arquivo √© otimizado para:
# - Bancos de dados com mais de 200GB em PRODU√á√ÉO
# - Tabelas individuais entre 1GB e 80GB 
# - ZERO LOCKS garantido (cr√≠tico para produ√ß√£o)
# - Backup com chunks ultra pequenos para m√°xima seguran√ßa
# - Configura√ß√£o testada em ambiente com erro 504

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES DOS SERVIDORES DE BANCO DE DADOS
# -----------------------------------------------------------------------------

# Servidor de origem (onde est√£o os dados para backup)
SOURCE_HOST=127.0.0.1
SOURCE_PORT=53306

# Servidor de destino (onde os backups ser√£o restaurados)
DEST_HOST=127.0.0.1
DEST_PORT=3306

# Credenciais de acesso aos bancos de dados
DB_USERNAME=seu_usuario
DB_PASSWORD=sua_senha

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES DE BACKUP PARA BANCOS GRANDES
# -----------------------------------------------------------------------------

# Databases a serem inclu√≠dos no backup (separados por v√≠rgula)
DATABASES=seu_database

# Agendamento do backup - Para bancos grandes, executar com menos frequ√™ncia
# Sugest√£o: 1x por dia durante madrugada (menos carga no servidor)
BACKUP_TIME="0 2 * * *"

# Reten√ß√£o mais longa para bancos grandes (recupera√ß√£o √© mais demorada)
RETENTION_DAYS=14

# SEMPRE ativar compress√£o para bancos grandes (economiza 60-80% do espa√ßo)
BACKUP_COMPRESSION=true

# Prefixo dos arquivos de backup
BACKUP_PREFIX=backup_large

# -----------------------------------------------------------------------------
# OP√á√ïES MYSQL OTIMIZADAS PARA BANCOS GRANDES - ZERO LOCKS
# -----------------------------------------------------------------------------

# MYSQLDUMP ULTRA ZERO-LOCK para PRODU√á√ÉO (sem nenhum tipo de lock)
MYSQLDUMP_OPTIONS="--single-transaction --quick --lock-tables=false --no-tablespaces --skip-lock-tables --skip-add-locks --routines --triggers --default-character-set=utf8mb4 --max_allowed_packet=2G --net_buffer_length=32K --extended-insert --disable-keys --no-autocommit --skip-opt"

# Cliente MySQL ULTRA otimizado (zero impacto)
MYSQL_CLIENT_OPTIONS="--max_allowed_packet=2G --net_buffer_length=32K"

# N√£o executar backup na inicializa√ß√£o (muito pesado)
RUN_ON_START=false

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES DE SISTEMA PARA BANCOS GRANDES
# -----------------------------------------------------------------------------

# Timezone do sistema
TZ=America/Sao_Paulo

# SEMPRE usar logs detalhados para monitoramento
LOG_LEVEL=INFO

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES DE PERFORMANCE PARA BANCOS GRANDES
# -----------------------------------------------------------------------------

# Timeout muito alto para opera√ß√µes longas (6 horas)
DB_TIMEOUT=21600

# Muitas tentativas para maior robustez
MAX_RETRY_ATTEMPTS=7

# Intervalo maior entre tentativas (recupera√ß√£o de falhas)
RETRY_INTERVAL=60

# SEMPRE ativar logs detalhados para bancos grandes
ENABLE_DEBUG_LOGS=true

# SEMPRE verificar integridade (cr√≠tico para backups grandes)
VERIFY_BACKUP_INTEGRITY=true

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES CR√çTICAS PARA CHUNKING DE TABELAS GRANDES
# -----------------------------------------------------------------------------
# ‚ö° CONFIGURA√á√ÉO ESPEC√çFICA PARA TABELAS DE 30-80GB

# SEMPRE ativar chunking para bancos grandes
ENABLE_AUTO_CHUNKING=true

# Detectar tabelas maiores que 100MB para chunking (mais sens√≠vel)
# Para ambiente produ√ß√£o, qualquer tabela > 100MB vira chunk
CHUNK_SIZE_THRESHOLD_MB=100

# CHUNK SIZE ULTRA PEQUENO para ZERO LOCKS (cr√≠tico!)
# Para tabelas de 7.9GB, chunks pequenos = ZERO impacto no banco
CHUNK_SIZE=5000

# Timeout MENOR para cada chunk (detec√ß√£o r√°pida de problemas)
CHUNK_TIMEOUT=180

# MUITAS tentativas para ambiente produ√ß√£o cr√≠tico
CHUNK_MAX_RETRIES=10

# INTERVALO MAIOR entre chunks (dar respiro ao banco)
CHUNK_INTERVAL_MS=2000

# -----------------------------------------------------------------------------
# NOTIFICA√á√ïES POR EMAIL (CR√çTICAS PARA BANCOS GRANDES)
# -----------------------------------------------------------------------------

# SEMPRE ativar notifica√ß√µes para monitorar backups longos
ENABLE_EMAIL_NOTIFICATIONS=true

# Configura√ß√µes do email
EMAIL_FROM=backup@suaempresa.com
EMAIL_TO=admin@suaempresa.com,dba@suaempresa.com
EMAIL_SUBJECT_PREFIX=[BACKUP-LARGE-DB]

# Configura√ß√µes do servidor SMTP
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=backup@suaempresa.com
SMTP_PASSWORD=sua_senha_smtp

# Usar TLS/SSL
SMTP_USE_TLS=true

# -----------------------------------------------------------------------------
# CONFIGURA√á√ïES DE WEBHOOK (OPCIONAL)
# -----------------------------------------------------------------------------

# URL do webhook para notifica√ß√µes em tempo real
WEBHOOK_URL=https://hooks.slack.com/seu-webhook

# Nome do webhook
WEBHOOK_USERNAME="Backup Sistema Grande"

# =============================================================================
# ESTIMATIVAS DE TEMPO PARA BANCOS GRANDES COM ULTRA ZERO-LOCK
# =============================================================================
# 
# Com essas configura√ß√µes ULTRA SEGURAS, para um banco de 200GB:
# 
# üïê Tempo estimado total: 4-8 horas (chunks pequenos mais seguros)
# üìä Chunks gerados: ~2.000-4.000 (chunks de 5k registros)
# üíæ Espa√ßo em disco necess√°rio: ~60GB (com compress√£o)
# üîÑ Restaura√ß√£o: 2-4 horas
# üõ°Ô∏è  Locks no banco: ZERO (configura√ß√£o ultra segura)
# 
# üí° CONFIGURA√á√ÉO ULTRA ZERO-LOCK:
# - Chunks de apenas 5.000 registros (micro impacto)
# - Pause de 2 segundos entre chunks (respiro para o banco)
# - Timeout de 3 minutos por chunk (detec√ß√£o r√°pida)
# - --skip-opt --no-autocommit (zero otimiza√ß√µes que causam lock)
# - Threshold 100MB (chunking mais agressivo)
#
# üö® CR√çTICO PARA PRODU√á√ÉO:
# - Execute durante madrugada para menor impacto
# - Monitore logs em /logs/backup.log continuamente
# - Teste primeiro em ambiente n√£o-produ√ß√£o
# - Verifique espa√ßo em disco (chunks criam mais arquivos tempor√°rios)
# - Configure monitoramento de performance do banco durante backup
#
# ‚ö° PARA BANCOS AINDA MAIS CR√çTICOS:
# - Reduza CHUNK_SIZE para 1000 ou 2000
# - Aumente CHUNK_INTERVAL_MS para 5000 (5 segundos)
# - Use CHUNK_SIZE_THRESHOLD_MB=50 (chunks ainda menores)
#
# =============================================================================
